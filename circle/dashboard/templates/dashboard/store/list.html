{% extends "dashboard/base.html" %}
{% load i18n %}
{% load store_tags %}

{% block title-page %}{% trans "Virtual machines" %}{% endblock %}

{% block content %}

<div class="row">
  <div class="col-md-12">
    <div class="list-group" id="store-list-list">
      <a href="?directory={{ up_url }}" class="list-group-item store-list-item" data-item-type="D">
        <i class="icon-reply store-list-item-icon"></i>
        ..
        <div class="pull-right">
          {{ current }}
        </div>
      </a>
    {% for f in root %}
    <a class="list-group-item store-list-item" data-item-type="{{ f.TYPE }}"
      href="{% if f.TYPE == "D" %}?directory={{ f.path }}{% else %}
      {# url "dashboard.views.store-download" #}?path={{ f.path }}{% endif %}">
      <div class="store-list-item-icon">
      <i class="
        icon-{% if f.TYPE == "D" %}folder-open-alt{% else %}file-alt{% endif %}"
        ></i>
    </div>
      {{ f.NAME }}
      <div class="store-list-item-size">
        {{ f.human_readable_size }}
      </div>
      <div class="clearfix"></div>
    </a>
      <div class="store-list-file-infos" style="position: relative;">
        <a href="{% url "dashboard.views.store-download" %}?path={{ f.path }}" 
          class="btn btn-primary" style="position: absolute; right: 15px; top: 32px;">
          <i class="icon-download"></i>
          Download
        </a>
        <dl class="dl-horizontal" style="margin: 0; padding: 0;">
          <dt>Filename</dt>
          <dd>{{ f.NAME }}</dd>

          <dt>Size</dt>
          <dd>{{ f.human_readable_size }}</dd>

          <dt>Latest modification</dt>
          <dd>{{ f.human_readable_date }}</dd>
        </dl>
      </div>
      {% empty %}
      <a class="list-group-item">
        {% trans "This folder is empty." %}
      </a>
    {% endfor %}
    <div class="list-group-item">
      Upload file to this folder
      <form action="" data-action="{% url "dashboard.views.store-upload" %}" 
        method="POST" enctype="multipart/form-data" class="pull-right"
        id="store-upload-form">
        {% csrf_token %}
        <input type="hidden" name="current_dir" value="{{ current }}"/>
        <div class="input-group" style="max-width: 400px;">
          <span class="input-group-btn" id="store-upload-browse">
            <span class="btn btn-primary btn-xs">
              {% trans "Browse..." %}
            </span>     
          </span>
          <input type="text" class="form-control input-tags" 
           id="store-upload-filename"/>
          <span class="input-group-btn">
            <input type="submit" class="btn btn-primary btn-xs"
            value="{% trans "Upload" %}"/>
          </span>
        </div>
        <input id="store-upload-file" name="data" type="file" style="display:none" multiple>
      </form>
    </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
  <script src="{{ STATIC_URL}}dashboard/store.js"></script>
{% endblock %}
