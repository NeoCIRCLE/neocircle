{% extends "dashboard/base.html" %}
{% load i18n %}
{% load sizefieldtags %}
{% load crispy_forms_tags %} 
{% block content %}

<div class="row">
  <div class="col-md-8">
    <div class="panel panel-default">
      <div class="panel-heading">
        <a class="pull-right btn btn-default btn-xs" href="{% url "dashboard.views.template-list" %}">Back</a>
        <h3 class="no-margin"><i class="icon-desktop"></i> {% trans "Edit template" %}</h3>
      </div>
      <div class="panel-body">
        {% with form=form %}
          {% include "display-form-errors.html" %}
        {% endwith %}
        {% crispy form %}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="no-margin"><i class="icon-group"></i> {% trans "Manage access"  %}</h4>
      </div>
      <div class="panel-body">
        <form action="{% url "dashboard.views.template-acl" pk=object.pk %}" method="post">{% csrf_token %}
          <table class="table table-striped table-with-form-fields">
            <thead><tr><th></th><th>{% trans "Who" %}</th><th>{% trans "What" %}</th><th></th></tr></thead>
            <tbody>
                {% for i in acl.users %}
                <tr><td><i class="icon-user"></i></td><td>{{i.user}}</td>
                    <td><select class="form-control" name="perm-u-{{i.user.id}}">
                            {% for id, name in acl.levels %}
                            <option{%if id = i.level%} selected="selected"{%endif%} value="{{id}}">{{name}}</option>
                            {% endfor %}
                    </select></td>
                    <td><a href="#" class="btn btn-link btn-xs"><i class="icon-remove"><span class="sr-only">{% trans "remove" %}</span></i></a></td></tr>
                {% endfor %}
                {% for i in acl.groups %}
                <tr><td><i class="icon-group"></i></td><td>{{i.group}}</td>
                    <td><select class="form-control" name="perm-g-{{i.group.id}}">
                            {% for id, name in acl.levels %}
                            <option{%if id = i.level%} selected="selected"{%endif%} value="{{id}}">{{name}}</option>
                            {% endfor %}
                    </select></td>
                    <td><a href="#" class="btn btn-link btn-xs"><i class="icon-remove"><span class="sr-only">{% trans "remove" %}</span></i></a></td></tr>
                {% endfor %}
                <tr><td><i class="icon-plus"></i></td>
                    <td><input type="text" class="form-control" name="perm-new-name"
                        placeholder="{% trans "Name of group or user" %}"></td>
                    <td><select class="form-control" name="perm-new">
                            {% for id, name in acl.levels %}
                            <option value="{{id}}">{{name}}</option>
                            {% endfor %}
                    </select></td><td></td>
                </tr>
          </tbody>
          </table>
          <div class="form-actions">
            <button type="submit" class="btn btn-success">{% trans "Save" %}</button>
          </div>
        </form>
      </div>
    </div>
    
        
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="no-margin"><i class="icon-file"></i> {% trans "Disk list" %}</h4>
      </div>
      <div class="panel-body">
        <ul class="template-disk-list">
        {% if not disks %}
          {% trans "No disks are added!" %}
        {% endif %}
        {% for d in disks %}
          <li>
            {% include "dashboard/_disk-list-element.html" %}
          </li>
        {% endfor %}
        </ul>
      </div>
    </div>
        
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="no-margin"><i class="icon-folder-open"></i> {% trans "Create new disk" %}</h4>
      </div>
      <div class="panel-body">
        <form action="{% url "dashboard.views.disk-add" %}" method="POST">
          {% crispy disk_add_form %} 
        </form>
      </div>
    </div>
  </div><!-- .col-md-4 -->
</div><!-- .row -->


<style>
  fieldset {
    margin-top: 40px;
  }
  fieldset legend {
    font-weight: bold;
  }
</style>
{% endblock %}

{% block extra_js %}
  <script>
    $(function() {
      $("#hint_id_num_cores, #hint_id_priority, #hint_id_ram_size").hide();
    });
  </script>

  <script src="{{ STATIC_URL }}dashboard/disk-list.js"></script>
{% endblock %}
