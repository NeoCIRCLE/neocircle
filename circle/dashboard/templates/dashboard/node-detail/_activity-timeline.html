{% load i18n %}
{% load hro %}
<div id="activity-timeline" class="timeline">
{% for a in activities %}
<div class="activity" data-activity-id="{{ a.pk }}">
  <span class="timeline-icon{% if a.has_failed %} timeline-icon-failed{% endif %}">
  <i class="fa {% if not a.finished %}fa-refresh fa-spin {% else %}fa-plus{% endif %}"></i>
</span>
<strong title="{{ a.result.get_admin_text }}">
  {{ a.readable_name.get_admin_text|capfirst }}
</strong>

{{ a.started|date:"Y-m-d H:i" }}, {{ a.user }}
  {% if a.children.count > 0 %}
    <div class="sub-timeline">
      {% for s in a.children.all %}
      <div data-activity-id="{{ s.pk }}" 
        class="sub-activity{% if s.has_failed %} sub-activity-failed{% endif %}"
        >
    {{ s.readable_name|get_text:user }}
         &ndash;
        {% if s.finished %}
          {{ s.finished|time:"H:i:s" }}
        {% else %}
          <i class="fa fa-refresh fa-spin" class="sub-activity-loading-icon"></i>
        {% endif %}
        {% if s.has_failed %}
          <div title="{{ s.result.get_admin_text }}" class="label label-danger">{% trans "failed" %}</div>
        {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endfor %}
</div>
